<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case Study Broh</title>
    <h1>Calculator Bruh</h1>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body>
    <form action="">
        <label for="rekening">Rekening tabungan:</label><br>
        <input type="number" id="rekening" name="rekening"><br>
        <label for="interest">Bunga citra Lestari:</label><br>
        <input type="number" id="interest" name="interest"><br>
        <label for="jangka">Masukkan jankga:</label><br>
        <input type="number" id="jangka" name="jangka"><br>
        <button type="button" onclick="kalku()">Kalkulasi</button>
        <h2 id="jumlah"></h2>
    </form>

    <div id="result"></div>

    <canvas id="chart" width="400" height="200"></canvas>

    <script>
        class SavingsCalculator{
            constructor(initialAmount, interestRate, period){
                this._initialAmount = initialAmount
                this._interestRate = interestRate
                this._period = period
            }

            get initialAmount(){
                return this._initialAmount
            }

            set initialAmount(value){
                this._initialAmount = value
            }

            get interestRate(){
                return this._interestRate
            }

            set interestRate(value){
                this._interestRate = value
            }

            get period(){
                return this._period
            }

            set period(value){
                this._period = value
            }

            calculateInterest(){
                return this._initialAmount * this._interestRate * this._period / 12
            }

            calculateYearlyInterest(){
                const yearlyInterest = []
                let totalAmount = this._initialAmount

                for(let year = 1; year<=this._period; year++){
                    const interest = (totalAmount * this._interestRate) / 100
                    totalAmount = totalAmount + interest
                    yearlyInterest.push({year:year, interest: interest.toFixed(2), totalAmount: totalAmount})
                }

                return yearlyInterest
            }
        }

        class ChartManager{
            constructor(){
                this.chart = null
            }

            createChart(data){
                const ctx = document.getElementById("chart")
                this.chart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: data.map(entry => 'Year ' + entry.year),
                        datasets: [{
                            label: 'Yearly interest',
                            data: data.map(entry => entry.interest),
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                })
            }
        }

        const chartManager = new ChartManager()

        function kalku(){
            var nilaiAwal = document.getElementById("rekening").value
            var bunga = document.getElementById("interest").value
            var jangka = document.getElementById("jangka").value
            var total = document.getElementById("jumlah")
            let counting = new SavingsCalculator(parseFloat(nilaiAwal),parseFloat(bunga),parseFloat(jangka))
            total.innerHTML = 'Total bro ' + counting.calculateInterest().toFixed(2)

            //const calculator = new SavingsCalculator(initialAmount, interestRate,period);
            const yearlyInterest = counting.calculateYearlyInterest();
            document.getElementById('result').innerHTML = `Total Interest Earned:$${yearlyInterest[yearlyInterest.length - 1].totalAmount}`; 

            // Tambahkan pemanggilan fungsi untuk membuat atau memperbarui grafik
            if (!chartManager.chart) {
                chartManager.createChart(yearlyInterest);
            } else {
                chartManager.updateChart(yearlyInterest);
            }
        }

    </script>
    
</body>
</html>